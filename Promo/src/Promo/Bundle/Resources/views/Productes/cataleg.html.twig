{% extends 'PromoBundle::layout.html.twig' %}

{% block title %}
Catálogo Promoquality{% if pare is not null %}. {{ pare.nom }}	{% endif %}
{% endblock %}

{% block breadcrumb %}
	{% set pareid = 0 %}
	{% if pare is not null %}
		{% set pareid = pare.id %}
		<div id="current-category">
			{% if pare.pare is null %}
			<h3><a href="{{ path('PromoBundle_catalogo') }}">{{ pare.root }}</a></h3>
			{% else %}
			<h3><a href="{{ path('PromoBundle_catalogo', {'categoria': pare.pare.ruta }) }}">{{ pare.root }}</a></h3>
			{% endif %}
		</div>
	{% endif %}
	
	{% if admin == true %}
		{# Si encara no hi ha categories pot afegir productes i tancar la recursivitat #}
		{% if categories|length == 0 %}
		<div id="admin-action">
			<a href="{{ path('PromoBundle_producto', {'categoria': pareid }) }}">Nuevo producto</a>
		</div>
		{% endif %}
		<div id="admin-action">
			<a href="{{ path('PromoBundle_categoria', {'pare': pareid }) }}">Nueva categoría</a>
		</div>
	{% endif %}
{% endblock %}

{% block content %}
	<ol id="list-cataleg"> 
	{% for categoria in categories %}
   		<li><a href="{{ path('PromoBundle_catalogo', {'categoria': categoria.ruta}) }}">
	   		<div class="cataleg-imatge"><img  width="{{ categoria.imatge.width }}" height="{{ categoria.imatge.height }}" alt="{{ categoria.imatge.titol }}" title="{{ categoria.imatge.titol }}" src="{{ asset('images/items/') }}{{ categoria.imatge.path }}"></div>
   			<div class="cataleg-nom">{{ categoria.nom }}</div></a>
   		</li>
   	{% endfor %}
	</ol> 
	
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script type="text/javascript">

	$(document).ready(function(){
		$("#menu-catalogo").addClass("menu-item-active");

		calculateAspectRatioFit = function(srcWidth, srcHeight, maxWidth, maxHeight) {
		    var ratio = [maxWidth / srcWidth, maxHeight / srcHeight ];
		    ratio = Math.min(ratio[0], ratio[1]);

		    return { width:srcWidth*ratio, height:srcHeight*ratio };
		}

    	$("#list-cataleg img").each(function() {
        	var a = calculateAspectRatioFit($(this).attr("width"), $(this).attr("height"), $(this).parent().width(), $(this).parent().height() - 10);
        	$(this).attr("width", Math.round(a.width));
        	$(this).attr("height", Math.round(a.height));

        	
        	if (Math.round(a.width) > Math.round(a.height)) {
            	
            	$(this).parent().addClass("cataleg-imatge-cell");
    		}
		});
		
	});

	
	</script>
    
{% endblock %}