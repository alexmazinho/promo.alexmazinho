{% extends 'PromoBundle::layout.html.twig' %}

{% block meta_description %}Promoquality - Panel administración. Formulario de gestión de categorias{% endblock %}

{% block meta_robots %}noindex, follow{% endblock %}

{% block title %}Promoquality - Panel administración. Formulario de gestión de categorías{% endblock %}

{% block breadcrumb %}

	<div id="current-category" class="category-item"><h3>
	{% if categoria.id is null %}
		{% if pare is null %}
			Nueva categoría principal
		{% else %}
			Nueva subcategoría de {{ pare.nom }}
		{% endif %}
	{% else %}
		Modificar categoria {{ categoria.nom }}
	{% endif %}</h3></div>
		
{% endblock %}

{% block content %}
 	{% if app.session.hasFlash('sms-notice') %}
    <div class="sms-notice">
        {{ app.session.flash('sms-notice') }}
    </div>
	{% endif %}
 	<div id="categoria" class="form-container">
		<form action="{{ path('PromoBundle_categoria') }}" method="post" {{ form_enctype(form) }}>
			{{ form_widget(form.id) }}
			
			<div id="portada-categoria" class="form-row clearfix">
				{{ form_label(form.imatge, 'Portada*:') }}
				{{ form_widget(form.imatge) }}
				{% if categoria.imatge is null %}
					<div class="galeria-upload">
						<div class="image-upload"><span class="box-center-txt">Subir portada<br/>(click)</span></div>
					</div>
				{% else %}
					<div class="galeria-upload">
						<div class="image-portada"><img height="200" src="{{ categoria.imatge.webPath }}" title="Cambiar imagen" alt="Cambiar imagen"></div>
					</div>
					<!-- 
					<div id="portada-item">
						<div class="portada-imatge">
							<img height="200" src="{# portada.webPath #}" title="{# portada.titol #}" alt="{# portada.titol #}">
						</div>	
						<div class="admin-actions"><a class="remove-item" href="javascript:void(0);">
	   						<img  width="15" height="15" alt="Cambiar imagen" title="Cambiar imagen" src="{# asset('images/delete-icon.gif') #}">
	   					</a></div>
					</div> -->
				{% endif %}
			</div>
			<div id="nom-categoria" class="form-row clearfix">
				{{ form_label(form.nom, 'Nombre*:') }}
				{{ form_widget(form.nom) }}
			</div>
			<div id="pare-categoria" class="form-row clearfix">
				{{ form_label(form.pare, 'Categoría padre:') }}
				{{ form_widget(form.pare) }}
			</div>
			
			{# form_rest(form.imatge) #}
			{{ form_rest(form) }}
			
			<div class="form-row clearfix"> 
				<label>&nbsp;</label>
	        	<input type="submit" class="submit-form" value="Guardar categoría" />
	        </div>  
		</form>
	</div>
{% endblock %}

{% block footer %}{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script type="text/javascript">
    	$(document).ready(function(){

    		hoverPortada($(".image-portada"));
    		
    		$('#categoria_imatge').imagePreview({ selector : '.galeria-upload', multiple: false, textover: 'Cambiar imagen' });
    		
			$(".galeria-upload").click(function() {
				$('#categoria_imatge').click();
				
			});

			/*$('#categoria_portada').change(function(click) {
				$('#image-upload').html(this.value);
			});*/
			
        });
    	
    /*
	$(document).ready(function(){
		$("#carrega-imatges").dropzone({ 
        	url: "/admin/galeria",
        	maxFilesize: 2, 
        	paramName: "file",
        	enqueueForUpload: false,
        	accept: function(file, done) {
            	// Després de added  
        		//this.removeAllFiles();
        		//if () this.removeFile(file);
        	},
        	init: function() {
        		var _this = this;

        		$("input:file").removeAttr('multiple');
        		
        	    this.on("addedfile", function(file) { 
         	 		alert("Added file." + file.name);
         	 		
            	    $('.dz-preview:not(:has(.deleteImage))').append('<span class="deleteImage">Delete</span>').click(function(){
						alert("esborrar"+file.name);
						_this.removeFile(file);
            	     });
            	     
            	});
        	    this.on("selectedfiles", function(files) { 
            	    alert("selected" + files.length); 
            	    //files.pop();
            	    //files=new Array(files[0]);
            	    
            	});
        	    this.on("dragleave", function(event) { 
            	    alert("Dragleave file." + event.target.nodeName); 
            	   // this.removeFile(event.target.text);
            	});
        	    this.on("removedfile", function(file) { 
            	    //    	    alert("Removed" + file.name); 
            	});
        	  }
        });

		
		
	});*/
	
	</script>
    
{% endblock %}